language: python

before_install:
    # Create .bashrc file.
    - echo > "${HOME}/.bashrc"
    - virtualenv "${HOME}/virtualenv/rose"
    - echo "source \"${HOME}/virtualenv/rose/bin/activate\"" >> "${HOME}/.bashrc"
    - echo "export PYTHONPATH=${PWD}/lib/python:${PYTHONPATH}" >> "${HOME}/.bashrc"
    - source "${HOME}/.bashrc"

install:
    - pip install sphinx

script:
    # Build Docs.
    - sphinx-build -aEW 'doc/sphinx' 'doc/sphinx/_build'
    - make -C 'doc/sphinx' html

after_success:
    # Deploy Docs.
    # TODO: Only deploy on merge.
    - git clone 'https://github.com/davisp/ghp-import'

    # Place docs in "doc" directory for historic reasons.
    - GHP_DIR="$(mktemp -d)"
    - ln -s "${PWD}/doc" "${GHP_DIR}/doc"
    - ln 'index.html' "${GHP_DIR}/index.html"

    # Push new documentation.
    - ./ghp-import/ghp_import.py -ln "${GHP_DIR}"
    - git push -fq "https://${GH_TOKEN}@github.com/${TRAVIS_REPO_SLUG}.git" gh-pages
